generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Task {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  title        String
  description  String?
  status       String    @default("pending")     // pending, in_progress, completed, canceled, ...
  priority     String    @default("medium")      // low, medium, high, urgent
  progress     Int       @default(0)             // 0-100 (%)
  startTime    DateTime?                         // th·ªùi gian b·∫Øt ƒë·∫ßu
  endTime      DateTime?                         // th·ªùi gian k·∫øt th√∫c
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tags         String[]                          // nh√£n (labels)
}

model Auth {
  id        String   @id @map("_id")
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  balance   Int        // s·ªë d∆∞ c√≤n l·∫°i
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  transactions Transaction[]
}

model Transaction {
  id          String           @id @default(auto()) @map("_id") @db.ObjectId
  description String           // m√¥ t·∫£ user
  amount      Int              // √¢m = chi, d∆∞∆°ng = thu
  type        TransactionType
  timestamp   DateTime         @default(now())
  account     Account          @relation(fields: [accountId], references: [id])
  accountId   String

  keyword     ActionKeyword?   @relation(fields: [keywordId], references: [id])
  keywordId   String?          @db.ObjectId

  @@index([keywordId])         // optional: index cho t√¨m theo keyword
}

model ActionKeyword {
  id        String           @id @default(auto()) @map("_id") @db.ObjectId
  phrase    String
  type      TransactionType
  createdAt DateTime         @default(now())

  transactions Transaction[]
}


enum TransactionType {
  income
  expense
}

model ChatLog {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  sender    Sender   // "user" ho·∫∑c "bot"
  message   String   // n·ªôi dung tin nh·∫Øn
  timestamp DateTime @default(now())
}

enum Sender {
  user
  bot
}

model Plan {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  status    PlanStatus @default(TODO)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  data      PlanData[]
}

model PlanData {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  planId  String   @db.ObjectId
  row     Int
  column  Int
  value   String

  plan    Plan     @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([planId, row, column])
}

enum PlanStatus {
  TODO
  COMPLETED
}

model Note {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  title         String
  content       String
  dueAt         DateTime
  warningHours  Int      // ‚è≥ S·ªë gi·ªù tr∆∞·ªõc h·∫°n ƒë·ªÉ c·∫£nh b√°o (v√≠ d·ª•: 2 = c·∫£nh b√°o tr∆∞·ªõc 2h)
  dangerHours   Int      // üö® S·ªë gi·ªù tr∆∞·ªõc h·∫°n ƒë·ªÉ b√°o ƒë·ªè (v√≠ d·ª•: 0.5 = b√°o ƒë·ªè tr∆∞·ªõc 30 ph√∫t)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}